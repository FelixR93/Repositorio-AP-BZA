<div class="dash">
  <div class="dash-top">
    <div>
      <h1>Dashboard</h1>
      <p class="sub">Bonanza (EXPAUSA.SA) — Inventario centralizado de MAC</p>
    </div>

    <button class="btn" type="button" (click)="refresh()">Actualizar</button>
  </div>

  <div *ngIf="loading" class="loading">Cargando información…</div>
  <div *ngIf="!loading && error" class="error">{{ error }}</div>

  <div *ngIf="!loading && !error">
    <!-- KPIs -->
    <div class="grid kpis">
      <div class="card">
        <div class="kpi-title">Total registros</div>
        <div class="kpi-value">{{ total }}</div>
        <div class="kpi-hint">MACs registradas en el sistema</div>
      </div>

      <div class="card">
        <div class="kpi-title">Control</div>
        <div class="kpi-value">{{ byArea.CONTROL }}</div>
        <div class="kpi-hint">Área responsable</div>
      </div>

      <div class="card">
        <div class="kpi-title">Seguridad</div>
        <div class="kpi-value">{{ byArea.SEGURIDAD }}</div>
        <div class="kpi-hint">Área responsable</div>
      </div>

      <div class="card">
        <div class="kpi-title">Monitoreo</div>
        <div class="kpi-value">{{ byArea.MONITOREO }}</div>
        <div class="kpi-hint">Área responsable</div>
      </div>
    </div>

    <!-- Distribución -->
    <div class="grid two">
      <div class="card">
        <div class="card-title">Distribución por AP</div>

        <div class="ap-list">
          <div class="ap-row" *ngFor="let ap of aps">
            <div class="ap-name">{{ ap }}</div>
            <div class="ap-bar">
              <div class="ap-fill" [style.width.%]="apPercent(ap)"></div>
            </div>
            <div class="ap-count">{{ byAp[ap] || 0 }}</div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-title">Dispositivos por tipo</div>

        <div class="type-grid">
          <div class="type-box">
            <div class="t">Móvil</div>
            <div class="v">{{ byType.MOVIL }}</div>
          </div>
          <div class="type-box">
            <div class="t">Laptop</div>
            <div class="v">{{ byType.LAPTOP }}</div>
          </div>
          <div class="type-box">
            <div class="t">PC</div>
            <div class="v">{{ byType.PC }}</div>
          </div>
        </div>

        <!-- ✅ Bitácora admin -->
        <div class="card-title" style="margin-top:14px;" *ngIf="isAdmin">Bitácora (ADMIN)</div>

        <div class="logs" *ngIf="isAdmin">
          <div class="log-row" *ngFor="let l of logs">
            <div class="log-main">
              <div class="log-title">
                <span class="tag">{{ l.action }}</span>
                {{ l.message }}
              </div>
              <div class="log-sub">
                {{ l.userName }} ({{ l.role }}) • {{ l.ip }} • {{ l.createdAt | date:'dd/MM/yyyy HH:mm' }}
              </div>
            </div>
          </div>

          <div class="empty-logs" *ngIf="logs.length === 0">
            No hay acciones registradas todavía.
          </div>
        </div>

      </div>
    </div>
  </div>
</div>
